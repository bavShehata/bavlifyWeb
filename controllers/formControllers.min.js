const mongoose=require("mongoose"),Contact=require("../models/contactModel.min.js"),Portfolio=require("../models/portfolioModel.min.js"),{body:body,validationResult:validationResult}=require("express-validator"),axios=require("axios"),nodemailer=require("nodemailer");require("dotenv/config");const reg={name:/^[a-z-_]{1,20}$/i,email:/^([^@]+)@(.+)\.(.+)$/i,message:/^[^\x05]{1,1000}$/};module.exports={validateContact:(e,o,a)=>{const{fname:t,lname:i,email:s,message:n}=e.body;if(reg.name.test(t)&&reg.name.test(i)&&reg.email.test(s)&&reg.message.test(n))return e.validInput=!0,void a();e.validInput=!1,a()},sanitizeContact:[body("fname").escape().trim(),body("lname").escape().trim(),body("email").trim().normalizeEmail().escape(),body("message").trim().escape()],postContact:async(e,o)=>{try{const{fname:a,lname:t,email:i,message:s}=e.body;if(!e.validInput)return void console.log("COULD NOT BE VALIDATED!!!",s);console.log("All input is valid");await Contact.create({fname:a,lname:t,email:i,message:s});console.log("Contact created successfully: ",i),uri="https://my-json-server.typicode.com/bavShehata/bavlifyWeb/portfolios";const n=(await axios.get(uri)).data;console.log("Number of portfolios: ",n.length),o.render("mainViews/index.ejs",{portfolios:n,contactSuccess:1})}catch(e){console.log("Couldn't add contact\n",e)}}};