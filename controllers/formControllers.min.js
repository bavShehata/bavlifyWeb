const mongoose=require('mongoose');const Contact=require('../models/contactModel');const Portfolio=require('../models/portfolioModel');const{body,validationResult}=require('express-validator');const axios=require('axios');const nodemailer=require('nodemailer');require('dotenv/config');const reg={name:/^[a-z-_]{1,20}$/i,email:/^([^@]+)@(.+)\.(.+)$/i,message:/^[^\x05]{1,1000}$/,};module.exports={validateContact:(req,res,next)=>{const{fname,lname,email,message}=req.body;if(reg.name.test(fname)&&reg.name.test(lname)&&reg.email.test(email)&&reg.message.test(message)){req.validInput=!0;next();return}
req.validInput=!1;next();return},sanitizeContact:[body('fname').escape().trim(),body('lname').escape().trim(),body('email').trim().normalizeEmail().escape(),body('message').trim().escape(),],postContact:async(req,res)=>{try{const{fname,lname,email,message}=req.body;if(!req.validInput){console.log('COULD NOT BE VALIDATED!!!',message);return}
console.log('All input is valid');var contact=await Contact.create({fname,lname,email,message,});console.log('Contact created successfully: ',email);uri='https://my-json-server.typicode.com/bavShehata/bavlifyWeb/portfolios';const result=await axios.get(uri);const portfolios=result.data;console.log('Number of portfolios: ',portfolios.length);res.render('mainViews/index.ejs',{portfolios,contactSuccess:1})}catch(e){console.log("Couldn't add contact\n",e)}},};