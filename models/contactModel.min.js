const mongoose=require("mongoose"),Schema=mongoose.Schema,nodemailer=require("nodemailer"),{isEmail:isEmail}=require("validator"),ContactSchema=new Schema({fname:{type:String,Required:[!0,"Please input a first name"]},lname:{type:String,Required:[!0,"Please input a last name"]},email:{type:String,Required:[!0,"Please input an email address"],lowercase:!0,validate:[isEmail,"Please enter a valid Email"]},message:{type:String,Required:[!0,"Please input a message"]}});ContactSchema.post("save",async function(){const{fname:e,lname:a,email:s,message:o}=this,n=nodemailer.createTransport({host:"smtp.gmail.com",port:465,secure:!0,auth:{user:process.env.gmailUser,pass:process.env.gmailPass}});n.verify(function(e,a){e?console.log("HERE IS THE ERROR\n",e):console.log("Server is ready to take our messages")});const t={from:"Your sender info here",to:process.env.gmailUser,subject:"New message from contact form at bavlifyweb.com",text:`${e} ${a} (${s}) says: ${o}`};n.sendMail(t,(e,a)=>{e?console.log("Email couldn't be sent\n",e):console.log("Email sent successfully")})});const contact=mongoose.model("contact",ContactSchema);module.exports=contact;